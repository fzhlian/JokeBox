"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.MemoryCacheHandler=void 0;const fs_extra_1=__importDefault(require("fs-extra")),project_config_path_js_1=require("../../../util/project-config-path.js"),abstract_cache_handler_js_1=require("./abstract-cache-handler.js");class MemoryCacheHandler extends abstract_cache_handler_js_1.AbstractCacheHandler{constructor(e,t){super(e),this.handlerName="",this.cacheStoreManager=t}readCache(e){if(fs_extra_1.default.existsSync(this.getCacheAbsolutePath())&&this.cacheStoreManager){const t=this.cacheStoreManager.mount(e.compileEnv).getCache(this.getCacheAbsolutePath());t&&(t.plugins&&project_config_path_js_1.projectConfigPath.replacePluginsCachePath(t.plugins,!1),t.modules.forEach(e=>{e&&project_config_path_js_1.projectConfigPath.replaceModuleCachePath(e,!1)}),e.cache=t)}this.next?.readCache(e)}writeCache(e){this.next?.writeCache(e)}async onBuildEnd(e,t,a,c){a&&(await e.close(),t&&this.cacheStoreManager?.mount(t).setCache(this.cacheDir,c,!0)),await(this.next?.onBuildEnd(e,t,a,c))}deleteModuleCache(e,t){if(this.cacheStoreManager&&t){const a=this.cacheStoreManager?.mount(t).getCache(this.getCacheAbsolutePath());if(!a?.modules)return;for(let t=0;t<a.modules.length;t++){if(a.modules[t].id===e){a.modules.splice(t,1);break}}}this.next?.deleteModuleCache(e,t)}}exports.MemoryCacheHandler=MemoryCacheHandler;