"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GenerateNativeLibrary=void 0;const path_1=__importDefault(require("path")),native_library_model_js_1=require("./native-library-model.js");class GenerateNativeLibrary{static parseLibrary(t,i,e,r){var s,a;const o=new native_library_model_js_1.NativeLibraryModel(i.name,i.id,i.type);return o.setAbi(t),o.setBuildType(e),o.setFolders(this.findFolders(i)),o.setFiles(this.findFiles(i)),o.setOutputs(this.findOutputs(i)),o.setNameOnDisk(i.nameOnDisk),o.setRuntimeFiles(this.findRuntimeFiles(i,r)),o.setBuild(null===(s=i.paths)||void 0===s?void 0:s.build),o.setSource(null===(a=i.paths)||void 0===a?void 0:a.source),o}static findFolders(t){var i;const e=[];return null===(i=t.compileGroups)||void 0===i||i.forEach(t=>{var i;null===(i=t.includes)||void 0===i||i.forEach(t=>{t.path&&e.push(t.path)})}),e}static findFiles(t){var i;const e=[];return null===(i=t.sources)||void 0===i||i.forEach(i=>{var r;const s=null!==(r=t.sourceGroups)&&void 0!==r?r:[],a=void 0===i.sourceGroupIndex?void 0:s[i.sourceGroupIndex];a&&"Source Files"!==a.name&&i.path&&e.push(i.path)}),e}static findOutputs(t){var i;const e=[];return null===(i=t.artifacts)||void 0===i||i.forEach(t=>{t.path&&e.push(t.path)}),e}static findRuntimeFiles(t,i){var e,r,s,a;const o=[];let l=null===(r=null===(e=t.link)||void 0===e?void 0:e.sysroot)||void 0===r?void 0:r.path;return l&&(l=path_1.default.resolve(l)),null===(a=null===(s=t.link)||void 0===s?void 0:s.commandFragments)||void 0===a||a.forEach(e=>{if("libraries"!==e.role)return;let r=e.fragment;r&&(r.startsWith("-")||r.endsWith(".a")||(!path_1.default.isAbsolute(r)||l&&r.startsWith(l)?this.handleBuildDir(t,i,r,l,o):o.push(r)))}),o}static handleBuildDir(t,i,e,r,s){var a,o;for(const l of[null===(a=t.paths)||void 0===a?void 0:a.build,null===(o=null==i?void 0:i.paths)||void 0===o?void 0:o.build])if(l){const t=path_1.default.join(l,e);if(r&&t.startsWith(r))continue;s.push(t)}}}exports.GenerateNativeLibrary=GenerateNativeLibrary;