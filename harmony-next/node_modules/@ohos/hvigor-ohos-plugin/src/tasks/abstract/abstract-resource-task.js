"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractResource=void 0;const restool_command_builder_js_1=require("../../builder/restool-command-builder.js"),restool_file_config_builder_js_1=require("../../builder/restool-file-config-builder.js"),build_directory_const_js_1=require("../../const/build-directory-const.js"),compile_resources_util_js_1=require("../../utils/compile-resources-util.js"),har_target_util_js_1=require("../../utils/har-target-util.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),ohos_hap_task_js_1=require("../task/ohos-hap-task.js"),_log=ohos_logger_js_1.OhosLogger.getLogger("Resource");class AbstractResource extends ohos_hap_task_js_1.OhosHapTask{constructor(e,o){super(e,o),this.outputDir=this.pathInfo.getIntermediatesRes(),this.restoolConfigBuilder=this.getRestoolConfigBuilder()}getRestoolConfigBuilder(){const e=this.initConfigTargetResource(),o=compile_resources_util_js_1.CompileResourcesUtil.getRestoolModuleNames(this.service,this.targetName).join(",");_log.debug(`restool module names: ${o}; moduleName=${this.moduleName}, taskName=${this.name}`),e.addModules(o).forceDelete();const t=new Map;return har_target_util_js_1.HarTargetUtil.getHarPathToResourcesDirMap(t,this.targetService),t.set(this.pathInfo.getModulePath(),[this.pathInfo.getResourceStr()]),t.forEach(o=>{o.forEach(o=>{e.addInputDir(o,build_directory_const_js_1.ResToolInputTypeConst.HAR)})}),e}initConfigTargetResource(){const e=new restool_file_config_builder_js_1.RestoolConfigBuilder;return this.targetService.getResourceDirs().forEach(o=>e.addInputDir(o,"Module")),e}getRestoolCommandBuilder(){const e=this.initCommandTargetResource();return e.addModules(compile_resources_util_js_1.CompileResourcesUtil.getRestoolModuleNames(this.service,this.targetName).join(",")).forceDelete(),e}initCommandTargetResource(){const e=new restool_command_builder_js_1.RestoolCommandBuilder(this.sdkInfo.getRestool()),o=new Map,t=new Map;this.targetService.getResourceDirs().forEach((e,t)=>{const s=compile_resources_util_js_1.CompileResourcesUtil.getCompileTargetFolderBySeq(build_directory_const_js_1.BuildDirConst.MODULE_COMPILED,t);o.set(e,s)});const s=new Map,r=[];return har_target_util_js_1.HarTargetUtil.getHarPathToResourcesDirMap(s,this.targetService),s.forEach(e=>{e.forEach(e=>{r.push(e)})}),r.forEach((e,o)=>{const s=compile_resources_util_js_1.CompileResourcesUtil.getCompileTargetFolderBySeq(build_directory_const_js_1.BuildDirConst.HAR_COMPILED,o);t.set(e,s)}),e.addModuleResourcesMap(o),e.addHarResourcesMap(t),e}}exports.AbstractResource=AbstractResource;