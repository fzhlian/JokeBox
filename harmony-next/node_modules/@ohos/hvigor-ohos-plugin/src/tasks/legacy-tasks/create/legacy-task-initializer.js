"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.legacyTasksInitialize=exports.legacyCommonHooksInitialize=exports.legacyHarTasksInitialize=exports.legacyHapTasksInitialize=void 0;const hvigor_1=require("@ohos/hvigor"),code_type_enum_1=require("../../../enum/code-type-enum"),build_native_with_cmake_1=require("../../build-native-with-cmake"),build_native_with_ninja_1=require("../../build-native-with-ninja"),cache_native_libs_1=require("../../cache-native-libs"),task_names_1=require("../../common/task-names"),configure_cmake_1=require("../../configure-cmake"),do_native_strip_1=require("../../do-native-strip"),generate_pkg_module_json_1=require("../../generate-pkg-module-json"),ark_linter_1=require("../../har/ark-linter"),assemble_hap_1=require("../../hook/assemble/assemble-hap"),assemble_har_1=require("../../hook/assemble/assemble-har"),compile_native_hook_1=require("../../hook/native/compile-native-hook"),build_har_previewer_res_1=require("../../hook/previewer/build-har-previewer-res"),build_previewer_res_1=require("../../hook/previewer/build-previewer-res"),preview_build_1=require("../../hook/previewer/preview-build"),legacy_package_har_1=require("../har/legacy-package-har"),legacy_process_har_artifacts_1=require("../har/legacy-process-har-artifacts"),legacy_process_oh_package_json_1=require("../har/legacy-process-oh-package-json"),legacy_hook_compile_resource_1=require("../hook/legacy-hook-compile-resource"),legacy_ark_compile_1=require("../legacy-ark-compile"),legacy_compile_lite_node_1=require("../legacy-compile-lite-node"),legacy_compile_node_1=require("../legacy-compile-node"),legacy_gen_lite_source_1=require("../legacy-gen-lite-source"),legacy_generate_har_js_manifest_1=require("../legacy-generate-har-js-manifest"),legacy_generate_har_loader_json_1=require("../legacy-generate-har-loader-json"),legacy_generate_js_manifest_1=require("../legacy-generate-js-manifest"),legacy_generate_loader_json_1=require("../legacy-generate-loader-json"),legacy_generate_metadata_1=require("../legacy-generate-metadata"),legacy_make_pack_info_1=require("../legacy-make-pack-info"),legacy_merge_profile_1=require("../legacy-merge-profile"),legacy_ohos_test_ark_compile_1=require("../legacy-ohos-test-ark-compile"),legacy_ohos_test_compile_node_1=require("../legacy-ohos-test-compile-node"),legacy_package_hap_1=require("../legacy-package-hap"),legacy_pre_build_1=require("../legacy-pre-build"),legacy_previewer_ark_compile_1=require("../legacy-previewer-ark-compile"),legacy_process_profile_1=require("../legacy-process-profile"),legacy_sign_lite_bin_1=require("../legacy-sign-lite-bin"),legacy_syscap_transform_1=require("../legacy-syscap-transform"),merge_node_assets_1=require("../merge-node-assets"),pre_check_syscap_1=require("../../pre-check-syscap"),process_libs_1=require("../../process-libs"),sign_hap_1=require("../../sign-hap"),syscap_transform_1=require("../../syscap-transform"),build_unit_test_hook_1=require("../../unitTest/build-unit-test-hook"),legacy_unit_test_ark_compile_1=require("../unit-test/legacy-unit-test-ark-compile"),unit_test_build_1=require("../../unitTest/unit-test-build"),validate_sign_1=require("../../validate-sign"),ohos_logger_1=require("../../../utils/log/ohos-logger"),task_util_1=require("../../../utils/task-util"),log=ohos_logger_1.OhosLogger.getLogger("TaskInitialization"),legacyHapTasksInitialize=e=>{var r;const a=process.hrtime(),i=null===(r=e.getModuleModel())||void 0===r?void 0:r.getModule();if(!i)return void log.printErrorExit("INVALID_MODULE_MODEL");const _=e.getTaskService();if(!_)return void log.printErrorExit("INVALID_MODULE_MODEL");const s=[];s.push(new assemble_hap_1.AssembleHap(_,!0)),s.push(new build_previewer_res_1.BuildPreviewerRes(_,!0)),s.push(...(0,exports.legacyCommonHooksInitialize)(_)),initializeTargetsTasks(i,e.getNeedExecTargetServiceList(),s),log.debug(`Module ${i.getName()} task initialization takes ${(0,hvigor_1.formatTime)(process.hrtime(a))}`)};exports.legacyHapTasksInitialize=legacyHapTasksInitialize;const legacyHarTasksInitialize=e=>{var r;const a=process.hrtime(),i=e.getTaskService();if(!i)return void log.printErrorExit("INVALID_MODULE_MODEL");const _=null===(r=e.getModuleModel())||void 0===r?void 0:r.getModule();if(!_)return void log.printErrorExit("INVALID_MODULE_MODEL");const s=[];s.push(new assemble_har_1.AssembleHar(i,!0)),s.push(new build_har_previewer_res_1.BuildHarPreviewerRes(i,!0)),s.push(...(0,exports.legacyCommonHooksInitialize)(i)),initializeTargetsTasks(_,e.getNeedExecTargetServiceList(),s),log.debug(`Module ${_.getName()} task initialization takes ${(0,hvigor_1.formatTime)(process.hrtime(a))}`)};exports.legacyHarTasksInitialize=legacyHarTasksInitialize;const legacyCommonHooksInitialize=e=>{const r=[];return r.push(new compile_native_hook_1.CompileNativeHook(e)),r.push(new preview_build_1.PreviewBuild(e,!0)),r.push(new unit_test_build_1.UnitTestBuild(e,!0)),r};exports.legacyCommonHooksInitialize=legacyCommonHooksInitialize;const initializeTargetsTasks=(e,r,a)=>{r.forEach(r=>{a.forEach(a=>e.registry(a)&&a.initTaskDepends(r)),(0,exports.legacyTasksInitialize)(e,r)})},legacyTasksInitialize=(e,r)=>{e.registry(new legacy_pre_build_1.LegacyPreBuild(r)),e.registry(new legacy_merge_profile_1.LegacyMergeProfile(r)),e.registry(new legacy_generate_js_manifest_1.LegacyGenerateJsManifest(r)),e.registry(new legacy_generate_loader_json_1.LegacyGenerateLoaderJson(r)),e.registry(new legacy_make_pack_info_1.LegacyMakePackInfo(r)),e.registry(new legacy_process_oh_package_json_1.LegacyProcessOHPackageJson(r)),e.registry(new legacy_process_profile_1.LegacyProcessProfile(r)),(0,task_util_1.dynamicResolveResourceTasks)(r,e),e.registry(new legacy_hook_compile_resource_1.LegacyHookCompileResource(r)),e.registry(new legacy_generate_har_loader_json_1.LegacyGenerateHarLoaderJson(r)),e.registry(new legacy_generate_har_js_manifest_1.LegacyGenerateHarJsManifest(r)),e.registry(new legacy_package_hap_1.LegacyPackageHap(r)),e.registry(new legacy_process_har_artifacts_1.LegacyProcessHarArtifacts(r)),e.registry(new legacy_package_har_1.LegacyPackageHar(r)),e.registry(new legacy_gen_lite_source_1.LegacyGenLiteSource(r)),e.registry(new merge_node_assets_1.MergeNodeAssets(r)),e.registry(new legacy_compile_lite_node_1.LegacyCompileLiteNode(r)),e.registry(new build_unit_test_hook_1.BuildUnitTestHook(r,!0)),e.registry(new legacy_generate_metadata_1.LegacyGenerateMetadata(r)),e.registry(new legacy_syscap_transform_1.LegacySyscapTransform(r)),e.registry(new legacy_sign_lite_bin_1.LegacySignLiteBin(r)),e.registry(new validate_sign_1.ValidateSigning(r)),e.registry(new legacy_ark_compile_1.LegacyArkCompile(r,code_type_enum_1.CodeType.ETS,task_names_1.TaskNames.LegacyFATask.COMPILE_ARK)),e.registry(new legacy_compile_node_1.LegacyCompileNode(r,code_type_enum_1.CodeType.ETS,task_names_1.TaskNames.LegacyFATask.COMPILE_NODE)),e.registry(new legacy_ark_compile_1.LegacyArkCompile(r,code_type_enum_1.CodeType.JS,task_names_1.TaskNames.LegacyFATask.COMPILE_ARK)),e.registry(new legacy_compile_node_1.LegacyCompileNode(r,code_type_enum_1.CodeType.JS,task_names_1.TaskNames.LegacyFATask.COMPILE_NODE)),e.registry(new legacy_ohos_test_ark_compile_1.LegacyOhosTestArkCompile(r,code_type_enum_1.CodeType.ETS)),e.registry(new legacy_ohos_test_ark_compile_1.LegacyOhosTestArkCompile(r,code_type_enum_1.CodeType.JS)),e.registry(new legacy_ohos_test_compile_node_1.LegacyOhosTestCompileNode(r,code_type_enum_1.CodeType.ETS)),e.registry(new legacy_ohos_test_compile_node_1.LegacyOhosTestCompileNode(r,code_type_enum_1.CodeType.JS)),e.registry(new legacy_previewer_ark_compile_1.LegacyPreviewerArkCompile(r,code_type_enum_1.CodeType.ETS,{name:"LegacyPreviewCompile"})),e.registry(new legacy_previewer_ark_compile_1.LegacyPreviewerArkCompile(r,code_type_enum_1.CodeType.JS,{name:"LegacyPreviewCompile"})),e.registry(new legacy_unit_test_ark_compile_1.LegacyUnitTestArkCompile(r,code_type_enum_1.CodeType.ETS,{name:"LegacyUnitTest"})),e.registry(new legacy_unit_test_ark_compile_1.LegacyUnitTestArkCompile(r,code_type_enum_1.CodeType.JS,{name:"LegacyUnitTest"})),e.registry(new build_native_with_cmake_1.BuildNativeWithCmake(r)),e.registry(new build_native_with_ninja_1.BuildNativeWithNinja(r)),e.registry(new configure_cmake_1.ConfigureCmake(r)),e.registry(new process_libs_1.ProcessLibs(r)),e.registry(new do_native_strip_1.DoNativeStrip(r)),e.registry(new cache_native_libs_1.CacheNativeLibs(r)),e.registry(new sign_hap_1.SignHap(r)),e.registry(new pre_check_syscap_1.PreCheckSyscap(r,task_names_1.TaskNames.CommonTask.PRE_CHECK_SYSCAP)),e.registry(new syscap_transform_1.SyscapTransform(r)),e.registry(new ark_linter_1.ArkLinter(r)),e.registry(new generate_pkg_module_json_1.GeneratePkgModuleJson(r))};exports.legacyTasksInitialize=legacyTasksInitialize;