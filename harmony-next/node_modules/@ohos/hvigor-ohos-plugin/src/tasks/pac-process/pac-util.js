"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.pacFileValidate=exports.checkPacJsonExistAndGetObj=exports.mergeDependencies=exports.checkPacJsonRequiredFields=void 0;const validate_util_js_1=require("../../utils/validate/validate-util.js"),fs_extra_1=__importDefault(require("fs-extra")),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),json_util_js_1=require("../../utils/json-util.js"),_log=ohos_logger_js_1.OhosLogger.getLogger("pac-util");function checkPacJsonRequiredFields(e){var s;if(!fs_extra_1.default.existsSync(e))return!1;let t={};try{t=null!==(s=(0,json_util_js_1.getJson5ObjThrowError)(e))&&void 0!==s?s:{}}catch(e){_log.debug("Catch error when parse pac.json5.",e)}const r=["dataProcess","specialAPIs"].some(e=>Object.prototype.hasOwnProperty.call(t,e));return r||_log.warn(`'pac.json5' is not properly enabled. Please check if the file ${e} contains the required fields: 'dataProcess' or 'specialAPIs'.`),r}function mergeDependencies(e,s){var t,r,i;s.dependencies||(s.dependencies=[]);const o=new Set;for(const n of e){const e={author:null!==(t=n.author)&&void 0!==t?t:"",name:n.name,description:null!==(r=n.description)&&void 0!==r?r:"",version:null!==(i=n.version)&&void 0!==i?i:""},a=JSON.stringify({name:e.name,version:e.version});o.has(a)||(s.dependencies.push(e),o.add(a))}}function checkPacJsonExistAndGetObj(e){var s;if(fs_extra_1.default.existsSync(e))try{return null!==(s=(0,json_util_js_1.getJson5ObjThrowError)(e))&&void 0!==s?s:{}}catch(e){_log.debug("Catch error when parse pac.json5.",e)}}function pacFileValidate(e,s,t){return!(!fs_extra_1.default.existsSync(s)||!fs_extra_1.default.existsSync(t))&&(!!checkPacJsonRequiredFields(s)&&(validate_util_js_1.ValidateUtil.submitSchemaCheckWork({moduleName:e,filePath:s,schemaPath:t}),!0))}exports.checkPacJsonRequiredFields=checkPacJsonRequiredFields,exports.mergeDependencies=mergeDependencies,exports.checkPacJsonExistAndGetObj=checkPacJsonExistAndGetObj,exports.pacFileValidate=pacFileValidate;