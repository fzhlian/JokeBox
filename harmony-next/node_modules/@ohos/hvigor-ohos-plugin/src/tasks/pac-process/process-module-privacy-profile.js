"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProcessModulePrivacyProfile=void 0;const task_names_js_1=require("../common/task-names.js"),pac_util_1=require("./pac-util");var Task=task_names_js_1.TaskNames.Task;const ohos_module_task_js_1=require("../task/ohos-module-task.js"),hvigor_1=require("@ohos/hvigor"),fs_extra_1=__importDefault(require("fs-extra")),pre_build_js_1=require("../pre-build.js"),ohos_logger_1=require("../../utils/log/ohos-logger");class ProcessModulePrivacyProfile extends ohos_module_task_js_1.OhosModuleTask{constructor(e){super(e,Task.PROCESS_MODULE_PRIVACY_PROFILE),this._log=ohos_logger_1.OhosLogger.getLogger(ProcessModulePrivacyProfile.name),this.originalModulePacJsonPath=this.pathInfo.getPacJsonPath(),this.processedPacJsonPath=this.pathInfo.getIntermediatesPacJsonPath()}taskShouldDo(){return super.taskShouldDo()&&!this.moduleModel.isHapModule()}doTaskAction(){const e=this.sdkInfo.getPacSchema();if((0,pac_util_1.pacFileValidate)(this.moduleName,this.originalModulePacJsonPath,e))try{fs_extra_1.default.copySync(this.originalModulePacJsonPath,this.processedPacJsonPath)}catch(e){this._log.printErrorExit("COPY_FILE_ERROR",[this.originalModulePacJsonPath])}}declareInputFiles(){const e=super.declareInputFiles();return this.originalModulePacJsonPath&&fs_extra_1.default.existsSync(this.originalModulePacJsonPath)&&e.addEntry(this.originalModulePacJsonPath),e}declareOutputFiles(){const e=new hvigor_1.FileSet;return e.addEntry(this.processedPacJsonPath),e}initTaskDepends(){this.dependsOn(pre_build_js_1.PreBuild.name)}}exports.ProcessModulePrivacyProfile=ProcessModulePrivacyProfile;