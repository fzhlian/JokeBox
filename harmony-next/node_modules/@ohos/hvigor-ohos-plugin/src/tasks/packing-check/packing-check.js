"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PackingCheck=void 0;const path_1=__importDefault(require("path")),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),task_names_js_1=require("../common/task-names.js"),code_type_enum_js_1=require("../../enum/code-type-enum.js"),ohos_hap_task_js_1=require("../task/ohos-hap-task.js");var Task=task_names_js_1.TaskNames.Task;const packing_check_util_js_1=require("../../utils/validate/packing-check-util.js"),build_directory_const_js_1=require("../../const/build-directory-const.js"),hvigor_common_1=require("@ohos/hvigor-common"),hvigor_logger_1=require("@ohos/hvigor-logger");class PackingCheck extends ohos_hap_task_js_1.OhosHapTask{constructor(e){var t,s;super(e,Task.PACKING_CHECK),this._log=ohos_logger_js_1.OhosLogger.getLogger(Task.PACKING_CHECK.name);const o=this.targetService.getTargetData().getPathInfo(),i=e.getTargetData().getTargetName();this.etsAssetsPath=path_1.default.resolve(o.getInterMediatesLoaderOutPath(),code_type_enum_js_1.CodeType.ETS),this.etsOriginalPath=null!==(s=null===(t=this.moduleModel.getSourceSetByTargetName(i).getCodeMap().get(code_type_enum_js_1.CodeType.ETS))||void 0===t?void 0:t.getSrcPath())&&void 0!==s?s:"",this.intermediateResourceDir=path_1.default.resolve(this.pathInfo.getIntermediatesRes(),build_directory_const_js_1.BuildDirConst.RESTOOL_BUILD_RESOURCES)}taskShouldDo(){var e,t;return null===(t=null===(e=this.targetService.getBuildOption().packOptions)||void 0===e?void 0:e.enableSourceCodeCheck)||void 0===t||t}doTaskAction(){const e=[],t=packing_check_util_js_1.PackingCheckUtil.collectSourceCodeFiles(this.etsAssetsPath);e.push(...packing_check_util_js_1.PackingCheckUtil.recoverOriginalPath(t,this.etsOriginalPath));const s=[".c",".h",".cpp",".cs",".java",".rs",".py",".go",".ets",".ts"],o=e=>s.some(t=>e.endsWith(t));packing_check_util_js_1.PackingCheckUtil.getResourcePaths(this.targetService).forEach(t=>{const s=packing_check_util_js_1.PackingCheckUtil.collectSourceCodeFiles(t,o);e.push(...packing_check_util_js_1.PackingCheckUtil.recoverOriginalPath(packing_check_util_js_1.PackingCheckUtil.recoverPackagedFiles(s,this.intermediateResourceDir),t))});const i=(0,hvigor_common_1.getOsLanguage)(),a=`${(0,hvigor_logger_1.getUrl)(hvigor_logger_1.DEVELOPER_URL)}/consumer/${i}/doc/harmonyos-guides/ide-hvigor-build-profile-app#section03812484215`;0!==e.length&&this._log.warn(`Unexpected source code files packaged in '${this.moduleName}'. Please remove them if not needed. Reference: ${a}\nIf the checking is not needed, you can set buildOption/packOptions/enableSourceCodeCheck to false at file: ${this.projectModel.getProfilePath()}\n${e.join("\n")}`),packing_check_util_js_1.PackingCheckUtil.clearResourceFilesCache()}initTaskDepends(){}}exports.PackingCheck=PackingCheck;