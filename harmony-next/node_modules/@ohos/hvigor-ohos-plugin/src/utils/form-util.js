"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.FormUtil=void 0;const path_1=__importDefault(require("path")),wdk_1=require("@baize/wdk"),file_util_js_1=require("./file-util.js"),json_util_js_1=require("./json-util.js");class FormUtil{static getFormConfigPathInModuleRes(e,t){const o=e.getSourceSetByTargetName(t).getTargetResPath(),r=path_1.default.resolve(o,"base","profile"),l=file_util_js_1.FileUtil.getAllFilesFromFolder(r);for(const e of l){const t=json_util_js_1.JsonUtil.getJson5Obj(e);if(null==t?void 0:t.forms)return e}}static resolveFormConfigPath(e,t,o){const r=e.getSourceSetByTargetName(t).getTargetResPath();return path_1.default.resolve(r,o)}static getFormWidgetModuleByTargetName(e,t){if(e.isFormExtensionModule(t)){const o=e.getSourceSetByTargetName(t).getModuleTargetRes().getModuleJsonOpt().module.formWidgetModule;return e.getParentProject().getModuleModelByName(null!=o?o:"")}}static getFormExtensionModuleByTargetName(e,t){if(e.isFormWidgetModule(t)){const o=e.getSourceSetByTargetName(t).getModuleTargetRes().getModuleJsonOpt().module.formExtensionModule;return e.getParentProject().getModuleModelByName(null!=o?o:"")}}static getTargetModuleOptObj(e,t){const o=e.getModuleService().getModuleModel(),r=e.getTargetData().getTargetName();let l=t.getModuleJsonOpt();const i=FormUtil.getFormExtensionModuleByTargetName(o,r);if(!i)return l;l=(0,wdk_1.cloneDeep)(l);const s=i.getJsonObjByTargetName(r);return s.module.extensionAbilities?(s.module.extensionAbilities.filter(e=>"form"===e.type).forEach(e=>{l.module.extensionAbilities||(l.module.extensionAbilities=[]);const t={name:e.name,type:e.type,metadata:e.metadata};l.module.extensionAbilities.push(t)}),l):l}}exports.FormUtil=FormUtil;