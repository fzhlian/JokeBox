"use strict";var __importDefault=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LogDiagnostic=exports.ClangLogHandler=void 0;const os_1=__importDefault(require("os"));var Level;!function(i){i[i.INFO=0]="INFO",i[i.WARNING=1]="WARNING",i[i.ERROR=2]="ERROR"}(Level||(Level={}));class ClangLogHandler{constructor(){this.state=0,this.lines=[],this._text=""}log(i){const t=doClassify(i);if(t.complete&&(this.lines.forEach(([i,t])=>{var e;return this.logging(null!==(e=this.currentDiagnostic)&&void 0!==e?e:t,i)}),this.lines=[]),(1===this.state&&t.main&&!t.after||0===this.state&&t.main)&&(this.currentDiagnostic=t),t.precede||t.main||1===this.state&&t.name===LogDiagnostic.NONE.name)return this.lines.push([i,t]),void this.updateState(t);this.logging(t,i),this.updateState(t)}updateState(i){i.main?this.state=1:(i.complete||i.precede)&&(this.state=0)}get text(){return this._text}logging(i,t){switch(i.level){case Level.INFO:this._text+=`[32m${t}[32m[39m${os_1.default.EOL}`;break;case Level.WARNING:this._text+=`[33m${t}[33m[39m${os_1.default.EOL}`;break;case Level.ERROR:this._text+=`[31m${t}[31m[39m${os_1.default.EOL}`;break;default:this._text+=`[32m${t}[32m[39m${os_1.default.EOL}`}}}exports.ClangLogHandler=ClangLogHandler;const doClassify=i=>{if(!i.includes(":")&&!i.includes("error")&&!i.includes("warning"))return LogDiagnostic.NONE;for(let t of LogDiagnostic.classifications){const e=t.match(i);if(e)return e}return LogDiagnostic.NONE};class LogDiagnostic{constructor(i,t,e,o,n,s,L){this.name=i,this.pattern=t,this.level=e,this.main=o,this.after=n,this.precede=s,this.complete=L}match(i){return this.pattern.test(i)?this:void 0}}exports.LogDiagnostic=LogDiagnostic,LogDiagnostic.IN_FILES_INCLUDED_FROM=new LogDiagnostic("IN_FILES_INCLUDED_FROM",/In file included from (?<file>.+):(?<line>\d+):/,Level.INFO,!1,!1,!0,!1),LogDiagnostic.CLANG_COMPILER_ERROR=new LogDiagnostic("CLANG_COMPILER_ERROR",/(?<file>(?:[A-Z]:)?[^\s][^:]+):(?<line>\d+):(?<column>\d+): (error|fatal error): (?<body>.*)/,Level.ERROR,!0,!1,!1,!0),LogDiagnostic.CLANG_LINKER_ERROR=new LogDiagnostic("CLANG_LINKER_ERROR",/((?:[A-Z]:)?[^\s][^:]+)(?::(\d+))?: (error|fatal error)?: (?<body>.+)/,Level.ERROR,!0,!1,!1,!0),LogDiagnostic.CLANG_COMPILER_WARNING=new LogDiagnostic("CLANG_COMPILER_WARNING",/(?<file>(?:[A-Z]:)?[^\s][^:]+):(?<line>\d+):(?<column>\d+): (warn|warning): (?<body>.*)/,Level.WARNING,!0,!1,!1,!0),LogDiagnostic.CLANG_LINKER_WARNING=new LogDiagnostic("CLANG_LINKER_WARNING",/((?:[A-Z]:)?[^\s][^:]+)(?::(\d+))?: (warn|warning)?: (?<body>.+)/,Level.WARNING,!1,!1,!1,!1),LogDiagnostic.LINK_FATAL=new LogDiagnostic("CLANG_COMPILER_ERROR",/.*ld: fatal error: (?<file>.*): (?<body>open: Invalid argument)/,Level.ERROR,!0,!1,!1,!0),LogDiagnostic.CLANG_COMPILER_INFO=new LogDiagnostic("CLANG_COMPILER_INFO",/(?<file>(?:[A-Z]:)?[^\s][^:]+):(\d+):(\d+): (ignored|note|remark): (?<body>.*)/,Level.INFO,!0,!0,!1,!1),LogDiagnostic.CLANG_LINKER_INFO=new LogDiagnostic("CLANG_LINKER_INFO",/((?:[A-Z]:)?[^\s][^:]+)(?::(\d+))?: (ignored|note|remark)?: (?<body>.+)/,Level.INFO,!0,!0,!1,!1),LogDiagnostic.CLANG_ERRORS_GENERATED=new LogDiagnostic("CLANG_ERRORS_GENERATED",/([0-9]* warnings?)?( and )?([0-9]* errors?)? generated./,Level.WARNING,!1,!1,!1,!0),LogDiagnostic.NINJA_ENTERING_DIRECTORY=new LogDiagnostic("NINJA_ENTERING_DIRECTORY",/ninja: Entering directory [`'](?<dir>[^']+)'/,Level.INFO,!1,!1,!1,!0),LogDiagnostic.NINJA_BUILD_STOPPED=new LogDiagnostic("NINJA_BUILD_STOPPED",/ninja: build stopped.*failed/,Level.ERROR,!1,!1,!1,!0),LogDiagnostic.FAILED_TARGET=new LogDiagnostic("FAILED_TARGET",/FAILED: .*/,Level.ERROR,!1,!1,!1,!0),LogDiagnostic.CLANG_COMMAND_LINE=new LogDiagnostic("CLANG_COMMAND_LINE",/.*clang(\+\+)?(\.exe)? .*--target.*ohos.*/,Level.ERROR,!1,!1,!1,!0),LogDiagnostic.NONE=new LogDiagnostic("NONE",/.*/,Level.INFO,!1,!1,!1,!1),LogDiagnostic.classifications=[LogDiagnostic.IN_FILES_INCLUDED_FROM,LogDiagnostic.CLANG_COMPILER_ERROR,LogDiagnostic.CLANG_LINKER_ERROR,LogDiagnostic.CLANG_COMPILER_WARNING,LogDiagnostic.CLANG_LINKER_WARNING,LogDiagnostic.LINK_FATAL,LogDiagnostic.CLANG_COMPILER_INFO,LogDiagnostic.CLANG_LINKER_INFO,LogDiagnostic.CLANG_ERRORS_GENERATED,LogDiagnostic.NINJA_ENTERING_DIRECTORY,LogDiagnostic.NINJA_BUILD_STOPPED,LogDiagnostic.FAILED_TARGET,LogDiagnostic.CLANG_COMMAND_LINE,LogDiagnostic.NONE];