"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReuseWatchWorkerManager=void 0;const path_1=__importDefault(require("path")),hvigor_1=require("@ohos/hvigor"),ohos_logger_js_1=require("../log/ohos-logger.js");class ReuseWatchWorkerManager{static async reuseWatchWorker(e,r,a){if(r)return ReuseWatchWorkerManager.logger.debug("Use normal worker. Cannot reuse watch worker"),!1;if(!ReuseWatchWorkerManager.preWorkerConfig||!hvigor_1.watchWorker.getWorker(ReuseWatchWorkerManager.preWorkerConfig.workerId))return ReuseWatchWorkerManager.logger.debug("No watchWorker available for preview"),!1;const o=ReuseWatchWorkerManager.preWorkerConfig.workerId;return ReuseWatchWorkerManager.canReuseWorker(e,a)&&await hvigor_1.watchWorker.getLastWatchResult(o)?(ReuseWatchWorkerManager.logger.debug("Find watchWorker that can be reused for preview"),hvigor_1.watchWorker.sendNewWatchMsgToProcess(o),!0):(ReuseWatchWorkerManager.logger.debug("Find watchWorker that can not be reused for preview, terminate it"),hvigor_1.watchWorker.terminate(o),ReuseWatchWorkerManager.clearPreWorkerConfig(),!1)}static clearPreWorkerConfig(){ReuseWatchWorkerManager.preWorkerConfig=void 0}static createWorker(e,r,a){const o=parseInt(a());r||isNaN(o)||ReuseWatchWorkerManager.updatePreWorkerConfig({...e,workerId:o})}static updatePreWorkerConfig(e){ReuseWatchWorkerManager.preWorkerConfig=e}static canReuseWorker(e,r){if(!ReuseWatchWorkerManager.preWorkerConfig)return!1;const a=ReuseWatchWorkerManager.preWorkerConfig;return e.modulePath===a.modulePath&&e.pageType===a.pageType&&(!r||a.pagesPath.includes(path_1.default.normalize(r)))}}exports.ReuseWatchWorkerManager=ReuseWatchWorkerManager,ReuseWatchWorkerManager.logger=ohos_logger_js_1.OhosLogger.getLogger(ReuseWatchWorkerManager.name),ReuseWatchWorkerManager.preWorkerConfig=void 0;