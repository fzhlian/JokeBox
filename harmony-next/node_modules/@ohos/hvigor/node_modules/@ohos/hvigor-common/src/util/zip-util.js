"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.readFileInZIP=exports.addFilesToZip=exports.getUint8ArrayReader=exports.getZipWriter=exports.getZipReader=void 0;const fs_1=__importDefault(require("fs")),zip_js_1=__importDefault(require("@zip.js/zip.js")),fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path"));function getZipReader(e){return new zip_js_1.default.ZipReader(new zip_js_1.default.BlobReader(e))}function getZipWriter(e){return new zip_js_1.default.ZipWriter(new zip_js_1.default.BlobWriter(e))}function getUint8ArrayReader(e){return new zip_js_1.default.Uint8ArrayReader(new Uint8Array(fs_extra_1.default.readFileSync(e)))}async function addFilesToZip(e,t,i,r=""){const a=fs_extra_1.default.readdirSync(t,{withFileTypes:!0});for(const n of a){const a=path_1.default.join(t,n.name),s=path_1.default.posix.join(r,n.name);if(n.isSymbolicLink()){const t=fs_extra_1.default.realpathSync(a);if(i.has(t))continue;i.add(t),await addFilesToZip(e,t,i,s)}else n.isDirectory()?await addFilesToZip(e,a,i,s):n.isFile()&&await e.add(s,getUint8ArrayReader(a))}}async function readFileInZIP(e,t){const i=new Map,r=fs_1.default.readFileSync(e),a=getZipReader(new Blob([r]));try{const e=await a.getEntries();for(const r of e)if(!r.directory&&t.includes(r.filename)){const e=r.getData&&await r.getData(new zip_js_1.default.TextWriter);i.set(r.filename,e||"")}}finally{a&&await a.close()}return i}exports.getZipReader=getZipReader,exports.getZipWriter=getZipWriter,exports.getUint8ArrayReader=getUint8ArrayReader,exports.addFilesToZip=addFilesToZip,exports.readFileInZIP=readFileInZIP;