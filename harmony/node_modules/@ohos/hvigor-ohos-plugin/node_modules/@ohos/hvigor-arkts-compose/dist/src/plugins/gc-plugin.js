"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.gcPlugin=void 0;const fs_js_1=require("../util/fs.js"),gcFilePrefix=".js";let hasShareCache=!1;function gcPlugin(){return{name:"gcPlugin",beforeBuild:gcBeforeBuild,transform:gcPluginTransform,afterBuildStart:gcHandler()}}function gcHandler(){return{order:"post",handler(){hasShareCache||global?.gc?.()}}}function gcBeforeBuild(){const e=this.share?.cache?.size();hasShareCache=void 0!==e&&e>0}async function gcPluginTransform(e,r){r.endsWith(gcFilePrefix)&&await(0,fs_js_1.checkFileExistsAndSize)(r)&&global.gc&&global.gc()}exports.gcPlugin=gcPlugin;