"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FaInitializationStrategy=void 0;const initialization_strategy_js_1=require("./initialization-strategy.js"),legacy_hap_plugin_js_1=require("../legacy/legacy-hap-plugin.js"),legacy_har_plugin_js_1=require("../legacy/legacy-har-plugin.js"),hap_extra_info_js_1=require("../../project/data/hap-extra-info.js"),common_const_js_1=require("../../const/common-const.js"),ohos_plugin_id_js_1=require("../common/ohos-plugin-id.js"),legacy_app_plugin_js_1=require("../legacy/legacy-app-plugin.js"),legacy_task_initializer_js_1=require("../../tasks/legacy-tasks/create/legacy-task-initializer.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js");class FaInitializationStrategy extends initialization_strategy_js_1.InitializationStrategy{constructor(){super(),this._log=ohos_logger_js_1.OhosLogger.getLogger(FaInitializationStrategy.name)}createAppPlugin(i){const e=new legacy_app_plugin_js_1.LegacyAppPlugin(i);return e.doProjectInspection(),e}createHapPlugin(i){const e=this.initPluginParam(new legacy_hap_plugin_js_1.LegacyHapPlugin(i),i,!0);return e.initGlobalData(),this.setUpModulePlugin(e,i),(0,legacy_task_initializer_js_1.legacyHapTasksInitialize)(e),e}createHarPlugin(i){const e=this.initPluginParam(new legacy_har_plugin_js_1.LegacyHarPlugin(i),i,!1);return e.initGlobalData(),this.setUpModulePlugin(e,i),(0,legacy_task_initializer_js_1.legacyHarTasksInitialize)(e),e}createProjectModel(i){const e=i.getProject(),t=e.getPluginById(ohos_plugin_id_js_1.OhosPluginId.OHOS_APP_PLUGIN);return t||this._log.printErrorExit("FA_NO_SYSTEM_PLUGIN",[`${[e.getBuildFilePath()]}.ts`],[[`${[e.getBuildFilePath()]}.ts`]]),t.getProjectModel()}initPluginParam(i,e,t){const a=this.createProjectModel(e),n=this.createModuleModel(a,e,t);return i.withProjectModel(a).withModuleModel(n).withPluginApiType(hap_extra_info_js_1.ApiType.FA).withRuntimeConfigFileName(common_const_js_1.CommonConst.CONFIG_JSON)}setUpModulePlugin(i,e){i.doModuleInspection(),i.initModuleTaskService(!0),i.initBuildOptionMap(e.getBuildProfilePath()),i.initTargetDepends(),i.initModuleCommonTasks(),i.initModuleCommonTasksForDiffApiType(!0)}}exports.FaInitializationStrategy=FaInitializationStrategy;