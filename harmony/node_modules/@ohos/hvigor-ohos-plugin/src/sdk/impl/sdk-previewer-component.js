"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SdkPreviewerComponent=void 0;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),hvigor_1=require("@ohos/hvigor"),json_util_js_1=require("../../utils/json-util.js"),sdk_component_js_1=require("../superior/sdk-component.js");class SdkPreviewerComponent extends sdk_component_js_1.SdkComponent{constructor(e){super(e),this.logger=hvigor_1.HvigorLogger.getLogger(SdkPreviewerComponent.name),this.sdkDefinePermissions=new Map,this.allowSdkPermission=!1,this.setPermissionData()}getCommonBin(){return path_1.default.resolve(this.getBaseDir(),SdkPreviewerComponent.COMMON,SdkPreviewerComponent.BIN)}setPermissionData(){var e,s;this.logger.debug("Start recording SDK configuration permission data.");const t=path_1.default.resolve(this.getBaseDir(),SdkPreviewerComponent.COMMON,SdkPreviewerComponent.RESOURCES_MODULE);if(!fs_1.default.existsSync(t))return void this.logger.debug(`The file does not exist. At ${t}`);const i=null===(s=null===(e=json_util_js_1.JsonUtil.getJson5Obj(t))||void 0===e?void 0:e.module)||void 0===s?void 0:s.definePermissions;i?(i.forEach(e=>{const s=e.grantMode,t=this.sdkDefinePermissions.get(s)||[];this.sdkDefinePermissions.set(s,[...t,e.name])}),this.allowSdkPermission=i.length>0):this.logger.warn(`Failed to obtain the valid permission list. Download the SDK again.\nat ${t} `)}getSdkPermissionNames(){return Array.from(this.sdkDefinePermissions.values()).reduce((e,s)=>[...e,...s],[])}getSdkDefineUserGrant(){return this.sdkDefinePermissions.get("user_grant")||[]}getSdkManualSettings(){return this.sdkDefinePermissions.get("manual_settings")||[]}}exports.SdkPreviewerComponent=SdkPreviewerComponent,SdkPreviewerComponent.COMMON="common",SdkPreviewerComponent.BIN="bin",SdkPreviewerComponent.RESOURCES_MODULE="resources/module.json";