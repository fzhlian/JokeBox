"use strict";var __decorate=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProcessIdDefinedFile=void 0;const path_1=__importDefault(require("path")),hvigor_1=require("@ohos/hvigor"),fs_extra_1=__importDefault(require("fs-extra")),json_util_js_1=require("../../utils/json-util.js"),task_names_js_1=require("../common/task-names.js"),ohos_hap_task_js_1=require("../task/ohos-hap-task.js");var Task=task_names_js_1.TaskNames.Task;class ProcessIdDefinedFile extends ohos_hap_task_js_1.OhosHapTask{declareInputFiles(){const e=super.declareInputFiles();return this.customIdDefinedFilePath&&e.addEntry(this.customIdDefinedFilePath),e}constructor(e){super(e,Task.PROCESS_ID_DEFINED_FILE),this.customIdDefinedFilePath=this.getCustomIdDefinedFilePath(),this.idDefinedJsonFile=this.pathInfo.getIntermediatesIdDefinedJsonFile()}taskShouldDo(){return this.targetService.shouldDoDeduplicateTask()&&void 0!==this.customIdDefinedFilePath&&fs_extra_1.default.existsSync(this.customIdDefinedFilePath)}beforeTask(){super.beforeTask(),fs_extra_1.default.existsSync(this.idDefinedJsonFile)&&fs_extra_1.default.rmSync(this.idDefinedJsonFile)}doTaskAction(){if(this.customIdDefinedFilePath){const e=json_util_js_1.JsonUtil.getJson5Obj(this.customIdDefinedFilePath);fs_extra_1.default.outputJSONSync(this.idDefinedJsonFile,e,{spaces:"\t"})}}initTaskDepends(){}getCustomIdDefinedFilePath(){var e;const t=null===(e=this.targetService.getBuildOption().resOptions)||void 0===e?void 0:e.idDefinedFilePath;if(t){const e=path_1.default.normalize(t);return path_1.default.isAbsolute(e)?e:path_1.default.resolve(this.projectModel.getProjectDir(),e)}}}__decorate([(0,hvigor_1.OutputFile)()],ProcessIdDefinedFile.prototype,"idDefinedJsonFile",void 0),exports.ProcessIdDefinedFile=ProcessIdDefinedFile;