"use strict";var __decorate=this&&this.__decorate||function(e,s,t,o){var r,a=arguments.length,i=a<3?s:null===o?o=Object.getOwnPropertyDescriptor(s,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,s,t,o);else for(var _=e.length-1;_>=0;_--)(r=e[_])&&(i=(a<3?r(i):a>3?r(s,t,i):r(s,t))||i);return a>3&&i&&Object.defineProperty(s,t,i),i},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProcessCompiledResources=void 0;const path_1=__importDefault(require("path")),fs_extra_1=__importDefault(require("fs-extra")),hvigor_1=require("@ohos/hvigor"),ohos_hap_task_js_1=require("./task/ohos-hap-task.js"),task_names_js_1=require("./common/task-names.js"),build_directory_const_js_1=require("../const/build-directory-const.js"),task_util_js_1=require("../utils/task-util.js");var Task=task_names_js_1.TaskNames.Task;class ProcessCompiledResources extends ohos_hap_task_js_1.OhosHapTask{constructor(e){super(e,Task.PROCESS_COMPILED_RESOURCES),this.preloadSoJsonPath=this.pathInfo.getPreloadSoFilePath(),this.resourcePath=path_1.default.resolve(this.pathInfo.getIntermediatesRes(),build_directory_const_js_1.BuildDirConst.RESTOOL_BUILD_RESOURCES)}taskShouldDo(){return!(0,task_util_js_1.isFastBuildApp)(this.service)&&this.isPreloadSystemSoJsonEffective&&fs_extra_1.default.existsSync(this.resourcePath)}beforeTask(){super.beforeTask();const e=this.getTaskTempDir(this.targetData,void 0,!1);fs_extra_1.default.existsSync(e)&&fs_extra_1.default.removeSync(e)}processPreloadSystemSoJson(){const e=this.getTaskTempDir(this.targetData);fs_extra_1.default.emptyDirSync(e);const s=path_1.default.resolve(e,path_1.default.basename(this.resourcePath));fs_extra_1.default.copySync(this.resourcePath,s),this.addPreloadSystemSoJson(this.getPreloadSystemSoJson(),e)}initTaskDepends(){}doTaskAction(){this.processPreloadSystemSoJson()}}__decorate([(0,hvigor_1.Input)()],ProcessCompiledResources.prototype,"resourcePath",void 0),__decorate([(0,hvigor_1.InputFile)()],ProcessCompiledResources.prototype,"preloadSoJsonPath",void 0),exports.ProcessCompiledResources=ProcessCompiledResources;