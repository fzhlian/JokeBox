"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.InjectUtil=void 0;const path_1=__importDefault(require("path")),hvigor_1=require("@ohos/hvigor"),hvigor_config_loader_js_1=require("@ohos/hvigor/src/common/util/hvigor-config-loader.js"),common_const_js_1=require("../const/common-const.js"),task_names_js_1=require("../tasks/common/task-names.js"),ohos_logger_js_1=require("./log/ohos-logger.js");class InjectUtil{static isHotReload(){return"true"===hvigor_1.hvigorCore.getExtraConfig().get(common_const_js_1.CommonConst.HOT_RELOAD)&&this.startParams.daemon}static isColdReload(){return hvigor_1.hvigorCore.isCommandEntryTask("assembleDevHqf")}static isDeviceTest(){return hvigor_1.hvigorCore.isCommandEntryTask(common_const_js_1.CommonConst.ON_DEVICE_TEST)}static isAssembleDevHqf(){return hvigor_1.hvigorCore.isCommandEntryTask("assembleDevHqf")}static isDaemon(){return this.startParams.daemon}static isPreviewProcess(){return"true"===hvigor_1.hvigorCore.getExtraConfig().get(common_const_js_1.CommonConst.PREVIEW_MODE)}static isUnitTestProcess(){return"true"===hvigor_1.hvigorCore.getExtraConfig().get(common_const_js_1.CommonConst.UNIT_TEST_MODE)}static isOhosTestCoverage(){return"true"===hvigor_1.hvigorCore.getExtraConfig().get(common_const_js_1.CommonConst.OHOS_TEST_COVERAGE)}static getCoveragePathFilter(){return hvigor_1.hvigorCore.getExtraConfig().get(common_const_js_1.CommonConst.COVERAGE_PATH_FILTER)}static getCoverageMode(){return hvigor_1.hvigorCore.getExtraConfig().get(common_const_js_1.CommonConst.COVERAGE_MODE)}static isDebugLineEnable(){return"true"===hvigor_1.hvigorCore.getExtraConfig().get(common_const_js_1.CommonConst.DEBUG_LINE)}static getBuildCacheParentDir(t,o,e=!0){const r=InjectUtil.getBuildDir(e);return r?path_1.default.isAbsolute(r)?(this._log&&!this.customBuildDirHasLogged&&(this._log.warn("Please ensure no projects of the same name have the same build cache dir."),this.customBuildDirHasLogged=!0),path_1.default.join(r,o.replace(":",path_1.default.sep))):(this._log&&!this.customBuildDirHasLogged&&(this._log.warn(`Invalid build cache dir: ${r}`),this.customBuildDirHasLogged=!0),t):t}static getModuleBuildRootPath(t){return InjectUtil.getBuildCacheParentDir(t,path_1.default.join(hvigor_1.hvigorCore.getProject().getName(),t.substring(hvigor_1.hvigorCore.getProject().getNodeDir().length)))}static getBuildDir(t=!0){let o=hvigor_1.hvigorCore.getExtraConfig().get(common_const_js_1.CommonConst.BUILD_CACHE_DIR);if((!o||t)&&(o||(o=hvigor_config_loader_js_1.HvigorConfigLoader.getInstance().getPropertiesConfigValue(common_const_js_1.CommonConst.BUILD_DIR_KEY),o))&&!this.isPreviewProcess()&&!this.isInTest())return o.replace(/^'|'$/g,"").replace(/^"|"$/g,"")}static isLocalTest(){return"true"===hvigor_1.hvigorCore.getExtraConfig().get(common_const_js_1.CommonConst.IS_LOCAL_TEST)}static isOhosTest(){return"true"===hvigor_1.hvigorCore.getExtraConfig().get(common_const_js_1.CommonConst.IS_OHOS_TEST)}static isInTest(){return this.isLocalTest()||this.isOhosTest()}static isByteCodeHarOptimize(){return!0===hvigor_1.hvigorCore.getParameter().getPropertyInternal(common_const_js_1.HvigorConfigConst.OHOS_BYTE_CODE_HAR_OPTIMIZE)}static isIntegratedHspUseGetCurrentBundleName(){return!0===hvigor_1.hvigorCore.getParameter().getProperty(common_const_js_1.HvigorConfigConst.OHOS_INTEGRATED_HSP_USE_GET_CURRENT_BUNDLE_NAME)}static isDependenciesTypesEnable(){return!0===hvigor_1.hvigorCore.getParameter().getPropertyInternal(common_const_js_1.HvigorConfigConst.OHOS_DEPENDENCIES_TYPES_ENABLE)}static getAlignDeviceTypes(){const t=hvigor_1.hvigorCore.getParameter().getPropertyInternal(common_const_js_1.HvigorConfigConst.OHOS_ALIGN_DEVICE_TYPES);return t?"string"==typeof t?t.split(","):Array.isArray(t)?t:[]:[]}static isTestFrameWork(){return hvigor_1.hvigorCore.isCommandEntryTask(task_names_js_1.TaskNames.CommonHookTask.GEN_ON_DEVICE_TEST_HAP.name)||hvigor_1.hvigorCore.isCommandEntryTask(task_names_js_1.TaskNames.Task.UNIT_TEST_BUILD.name)||hvigor_1.hvigorCore.isCommandEntryTask(task_names_js_1.TaskNames.Task.TEST.name)||hvigor_1.hvigorCore.isCommandEntryTask(task_names_js_1.TaskNames.Task.ON_DEVICE_TEST.name)||this.isOhosTestCoverage()||this.isInTest()}static getEntryModulesName(){const t=hvigor_1.hvigorCore.getExtraConfig().get("module");return t?t.split(",").map(t=>t.split("@")[0]):[]}static isSingleFileEmitEnabled(){var t;return null!==(t=hvigor_1.hvigorCore.getParameter().getPropertyInternal(common_const_js_1.CommonConst.SINGLE_FILE_EMIT))&&void 0!==t&&t}static isSync(){return!!hvigor_1.globalData.cliOpts.sync}}exports.InjectUtil=InjectUtil,InjectUtil._log=ohos_logger_js_1.OhosLogger.getLogger("InjectUtil"),InjectUtil.startParams=hvigor_1.hvigorCore.getParameter().getStartParamsInternal(),InjectUtil.customBuildDirHasLogged=!1;