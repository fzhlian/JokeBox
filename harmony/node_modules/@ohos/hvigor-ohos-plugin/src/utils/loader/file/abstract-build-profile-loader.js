"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractBuildProfileLoader=void 0;const path_1=__importDefault(require("path")),hvigor_1=require("@ohos/hvigor"),fs_extra_1=__importDefault(require("fs-extra")),common_const_js_1=require("../../../const/common-const.js"),json_util_js_1=require("../../json-util.js"),ohos_logger_js_1=require("../../log/ohos-logger.js"),validate_util_js_1=require("../../validate/validate-util.js"),validator_store_js_1=require("../../validate/validator-store.js"),config_file_loader_js_1=require("../config-file-loader.js");class AbstractBuildProfileLoader{constructor(){this._log=ohos_logger_js_1.OhosLogger.getLogger("BuildProfileLoader")}getBuildProfileJson5Obj(e,o=!0,t){const i=hvigor_1.hvigor.getNodeByNameInternal(e,t);if(void 0===i)return void this._log.printErrorExit("NODE_NOT_FOUND_BY_NODE_NAME",[e]);const r=path_1.default.resolve(i.getNodePathInternal(),common_const_js_1.CommonConst.PROFILE_JSON5),s=config_file_loader_js_1.configFileLoader.getConfigFileJson(r);if(void 0!==s)return s;if(fs_extra_1.default.existsSync(r)){let t=json_util_js_1.JsonUtil.getJson5Obj(r);return t=this.initializeReplace(t),this.setBuildProfileJson5Obj(e,t,o),t}this._log.warn(`not found build-profile json file in : ${r}`)}setBuildProfileJson5ObjCheck(e,o,t,i){const r=hvigor_1.hvigor.getNodeByNameInternal(e,i);if(void 0===r)return void this._log.printErrorExit("NODE_NOT_FOUND_BY_NODE_NAME",[e]);const s=path_1.default.resolve(r.getNodePathInternal(),common_const_js_1.CommonConst.PROFILE_JSON5);config_file_loader_js_1.configFileLoader.setConfigFileJson(s,o),t&&this.validateBuildProfile(o,s,t)}validateBuildProfile(e,o,t){const i=validator_store_js_1.ValidatorStore.addValidator(t);try{validate_util_js_1.ValidateUtil.schemaCheckJSObject(e,void 0,i)}catch(e){e instanceof Error&&this._log.errorMessageExit(e.name,e.message)}}initializeReplace(e){return e}}exports.AbstractBuildProfileLoader=AbstractBuildProfileLoader;